<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paperlinse - Document Management</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="app">
        <nav class="sidebar">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span>Paperlinse</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="documents">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                        <polyline points="13 2 13 9 20 9"></polyline>
                    </svg>
                    <span>Documents</span>
                </li>
                <li class="nav-item" data-page="queue">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Queue</span>
                </li>
                <li class="nav-item" data-page="logs">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <line x1="10" y1="9" x2="8" y2="9"></line>
                    </svg>
                    <span>Logs</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>Settings</span>
                </li>
            </ul>
        </nav>
        
        <main class="content">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <header class="page-header">
                    <h1>Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="triggerScan()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Scan Now
                        </button>
                    </div>
                </header>
                <div class="dashboard-content">
                    <div class="status-cards">
                        <div class="status-card">
                            <div class="status-icon pending">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="status-info">
                                <span class="status-value" id="pending-count">-</span>
                                <span class="status-label">Pending Files</span>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon awaiting">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 11l3 3L22 4"></path>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                </svg>
                            </div>
                            <div class="status-info">
                                <span class="status-value" id="awaiting-count">-</span>
                                <span class="status-label">Awaiting Approval</span>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon processed">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                            <div class="status-info">
                                <span class="status-value" id="approved-count">-</span>
                                <span class="status-label">Approved</span>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon error">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                            </div>
                            <div class="status-info">
                                <span class="status-value" id="error-count">-</span>
                                <span class="status-label">Errors</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="processing-mode-card">
                        <div class="mode-info">
                            <h3>Processing Mode</h3>
                            <p id="mode-description">Documents require manual approval before being moved to storage.</p>
                        </div>
                        <div class="mode-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-mode-toggle" onchange="toggleProcessingMode()">
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="mode-label">Manual</span>
                        </div>
                    </div>
                    
                    <div class="setup-prompt" id="setup-prompt">
                        <div class="setup-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                        </div>
                        <h2>Welcome to Paperlinse</h2>
                        <p>Configure your incoming scan folder and document storage to get started.</p>
                        <button class="btn btn-primary" onclick="navigateTo('settings')">Configure Settings</button>
                    </div>
                </div>
            </div>
            
            <!-- Documents Page -->
            <div id="page-documents" class="page">
                <header class="page-header">
                    <h1>Documents</h1>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" placeholder="Search documents..." id="search-input" onkeyup="handleSearch(event)">
                        </div>
                    </div>
                </header>
                
                <div class="filters-bar">
                    <select id="filter-status" onchange="loadDocuments()">
                        <option value="">All Status</option>
                        <option value="awaiting_approval">Awaiting Approval</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                        <option value="error">Error</option>
                    </select>
                    <input type="text" id="filter-sender" placeholder="Filter by sender..." onkeyup="debounceLoadDocs()">
                    <input type="date" id="filter-date-from" onchange="loadDocuments()" placeholder="From date">
                    <input type="date" id="filter-date-to" onchange="loadDocuments()" placeholder="To date">
                    <button class="btn btn-secondary btn-small" onclick="clearFilters()">Clear</button>
                </div>
                
                <div class="documents-content" id="documents-list">
                    <p class="placeholder-text">Loading documents...</p>
                </div>
            </div>
            
            <!-- Queue Page (Incoming Files) -->
            <div id="page-queue" class="page">
                <header class="page-header">
                    <h1>Incoming Files</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="triggerScan()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Scan
                        </button>
                        <button class="btn btn-primary" onclick="processQueue()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Process All
                        </button>
                    </div>
                </header>
                <div class="queue-grid" id="queue-list">
                    <p class="placeholder-text">Loading files...</p>
                </div>
            </div>
            
            <!-- Logs Page -->
            <div id="page-logs" class="page">
                <header class="page-header">
                    <h1>System Logs</h1>
                    <div class="header-actions">
                        <select id="log-source" onchange="loadLogs()">
                            <option value="paperlinse">Application</option>
                            <option value="ipex-ollama">LLM (Ollama)</option>
                        </select>
                        <select id="log-level" onchange="filterLogs()">
                            <option value="all">All Levels</option>
                            <option value="error">Errors Only</option>
                            <option value="warning">Warnings & Errors</option>
                            <option value="info">Info & Above</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadLogs()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Refresh
                        </button>
                        <label class="toggle-label">
                            <input type="checkbox" id="log-auto-refresh" onchange="toggleLogAutoRefresh()">
                            <span>Auto-refresh</span>
                        </label>
                    </div>
                </header>
                <div class="logs-container">
                    <div class="logs-info">
                        <span id="logs-count">0 entries</span>
                        <span id="logs-file"></span>
                    </div>
                    <div class="logs-content" id="logs-content">
                        <p class="placeholder-text">Loading logs...</p>
                    </div>
                </div>
            </div>
            
            <!-- Document Preview Modal (Fullscreen) -->
            <div id="preview-modal" class="modal modal-fullscreen">
                <div class="preview-modal-content">
                    <div class="preview-header">
                        <h2 id="preview-title">Document Preview</h2>
                        <button class="modal-close" onclick="closePreviewModal()">&times;</button>
                    </div>
                    <div class="preview-body" id="preview-body">
                        <!-- Preview content loaded dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Document Detail Modal -->
            <div id="document-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modal-title">Document Details</h2>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-body">
                        <!-- Content loaded dynamically -->
                    </div>
                    <div class="modal-footer" id="modal-footer">
                        <!-- Actions loaded dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="page-settings" class="page">
                <header class="page-header">
                    <h1>Settings</h1>
                </header>
                <div class="settings-content">
                    <!-- Incoming Scan Folder Section -->
                    <section class="settings-section" id="incoming-section">
                        <div class="section-header">
                            <h2>Incoming Scan Folder</h2>
                            <button type="button" class="btn btn-secondary btn-small" id="incoming-edit-btn" onclick="toggleShareEdit('incoming')">Edit</button>
                        </div>
                        
                        <!-- Summary View (shown when configured) -->
                        <div id="incoming-summary" class="share-summary">
                            <div class="summary-row">
                                <span class="summary-label">Path:</span>
                                <span class="summary-value" id="incoming-summary-path">Not configured</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Status:</span>
                                <span class="summary-value" id="incoming-summary-status">-</span>
                            </div>
                            <div class="summary-row" id="incoming-summary-creds-row">
                                <span class="summary-label">Credentials:</span>
                                <span class="summary-value" id="incoming-summary-creds">None</span>
                            </div>
                        </div>
                        
                        <!-- Edit Form (hidden by default when configured) -->
                        <div id="incoming-form" class="share-form" style="display: none;">
                            <p class="section-description">Configure the folder where your scanner saves documents. Paperlinse will monitor this folder for new files.</p>
                            
                            <div class="form-group">
                                <label for="incoming-path">Folder Path</label>
                                <div class="input-with-button">
                                    <input type="text" id="incoming-path" placeholder="/mnt/scanner or //server/share">
                                    <button type="button" class="btn btn-secondary" onclick="testConnection('incoming')">Test</button>
                                </div>
                                <span class="form-hint">Local path or network share (e.g., /mnt/scanner, //fileserver/scans)</span>
                                <div id="incoming-test-result" class="test-result"></div>
                            </div>
                            
                            <div class="credentials-section">
                                <h3>Authentication (optional)</h3>
                                <p class="section-description">Required for network shares that need authentication.</p>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="incoming-username">Username</label>
                                        <input type="text" id="incoming-username" placeholder="username">
                                    </div>
                                    <div class="form-group">
                                        <label for="incoming-domain">Domain</label>
                                        <input type="text" id="incoming-domain" placeholder="WORKGROUP">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="incoming-password">Password</label>
                                    <input type="password" id="incoming-password" placeholder="password">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="saveShareConfig('incoming')">Save</button>
                                <button type="button" class="btn btn-secondary" onclick="cancelShareEdit('incoming')">Cancel</button>
                                <span id="incoming-save-status" class="save-status"></span>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Document Storage Section -->
                    <section class="settings-section" id="storage-section">
                        <div class="section-header">
                            <h2>Document Storage</h2>
                            <button type="button" class="btn btn-secondary btn-small" id="storage-edit-btn" onclick="toggleShareEdit('storage')">Edit</button>
                        </div>
                        
                        <!-- Summary View (shown when configured) -->
                        <div id="storage-summary" class="share-summary">
                            <div class="summary-row">
                                <span class="summary-label">Path:</span>
                                <span class="summary-value" id="storage-summary-path">Not configured</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Status:</span>
                                <span class="summary-value" id="storage-summary-status">-</span>
                            </div>
                            <div class="summary-row" id="storage-summary-creds-row">
                                <span class="summary-label">Credentials:</span>
                                <span class="summary-value" id="storage-summary-creds">None</span>
                            </div>
                        </div>
                        
                        <!-- Edit Form (hidden by default when configured) -->
                        <div id="storage-form" class="share-form" style="display: none;">
                            <p class="section-description">Configure where processed documents will be stored and organized.</p>
                            
                            <div class="form-group">
                                <label for="storage-path">Storage Path</label>
                                <div class="input-with-button">
                                    <input type="text" id="storage-path" placeholder="/mnt/documents or //server/documents">
                                    <button type="button" class="btn btn-secondary" onclick="testConnection('storage')">Test</button>
                                </div>
                                <span class="form-hint">Where processed documents will be stored</span>
                                <div id="storage-test-result" class="test-result"></div>
                            </div>
                            
                            <div class="credentials-section">
                                <h3>Authentication (optional)</h3>
                                <p class="section-description">Required for network shares that need authentication.</p>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="storage-username">Username</label>
                                        <input type="text" id="storage-username" placeholder="username">
                                    </div>
                                    <div class="form-group">
                                        <label for="storage-domain">Domain</label>
                                        <input type="text" id="storage-domain" placeholder="WORKGROUP">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="storage-password">Password</label>
                                    <input type="password" id="storage-password" placeholder="password">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="saveShareConfig('storage')">Save</button>
                                <button type="button" class="btn btn-secondary" onclick="cancelShareEdit('storage')">Cancel</button>
                                <span id="storage-save-status" class="save-status"></span>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Scheduler Settings -->
                    <section class="settings-section">
                        <h2>Scheduler</h2>
                        <p class="section-description">Configure how often Paperlinse checks for new documents.</p>
                        
                        <div class="form-group">
                            <label for="poll-interval">Scan Interval (seconds)</label>
                            <input type="number" id="poll-interval" value="30" min="5" max="3600">
                            <span class="form-hint">How often to check the incoming folder for new files (5-3600 seconds)</span>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveSchedulerConfig()">Save Interval</button>
                            <span id="scheduler-save-status" class="save-status"></span>
                        </div>
                    </section>
                    
                    <!-- Processing Mode Settings -->
                    <section class="settings-section">
                        <h2>Processing Mode</h2>
                        <p class="section-description">Choose how documents are handled after OCR processing.</p>
                        
                        <div class="mode-options">
                            <label class="mode-option">
                                <input type="radio" name="processing-mode" value="automatic" id="mode-automatic">
                                <div class="mode-content">
                                    <span class="mode-title">Automatic</span>
                                    <span class="mode-desc">Documents are processed and moved to storage automatically.</span>
                                </div>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="processing-mode" value="manual" id="mode-manual" checked>
                                <div class="mode-content">
                                    <span class="mode-title">Manual</span>
                                    <span class="mode-desc">Documents require approval before being moved to storage.</span>
                                </div>
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveProcessingMode()">Save Mode</button>
                            <span id="mode-save-status" class="save-status"></span>
                        </div>
                    </section>
                    
                    <!-- Processing Performance Settings -->
                    <section class="settings-section">
                        <h2>Processing Performance</h2>
                        <p class="section-description">Configure how many documents are processed simultaneously.</p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="concurrent-workers">Concurrent Workers</label>
                                <input type="number" id="concurrent-workers" value="3" min="1" max="10">
                                <span class="form-hint">Number of documents to process at the same time (1-10)</span>
                            </div>
                            <div class="form-group">
                                <label for="batch-size">Batch Size</label>
                                <input type="number" id="batch-size" value="10" min="1" max="50">
                                <span class="form-hint">Maximum documents to queue per processing cycle (1-50)</span>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveProcessingConfig()">Save Performance Settings</button>
                            <span id="processing-config-save-status" class="save-status"></span>
                        </div>
                    </section>
                    
                    <!-- LLM Settings -->
                    <section class="settings-section">
                        <div class="section-header">
                            <h2>LLM Settings</h2>
                            <button type="button" class="btn btn-secondary btn-small" onclick="resetLLMConfig()">Reset Prompts to Defaults</button>
                        </div>
                        <p class="section-description">Configure the LLM model and prompts used to analyze and classify documents.</p>
                        
                        <!-- Model Selection -->
                        <div class="form-group">
                            <label>LLM Model</label>
                            <div id="models-status-container">
                                <span id="models-loading" class="loading-text">Loading models...</span>
                            </div>
                        </div>
                        
                        <div id="models-list" class="models-list">
                            <!-- Models loaded dynamically -->
                        </div>
                        
                        <div id="model-pull-progress" class="model-pull-progress" style="display: none;">
                            <div class="pull-progress-header">
                                <span id="pull-model-name">Downloading model...</span>
                                <span id="pull-status">Starting...</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="pull-progress-fill" style="width: 0%"></div>
                            </div>
                            <span id="pull-percentage">0%</span>
                        </div>
                        
                        <hr class="section-divider">
                        
                        <h3>Prompt Configuration</h3>
                        <p class="section-description">Use <code>{text}</code> as placeholder for the document text.</p>
                        
                        <div class="form-group">
                            <label for="llm-system-prompt">System Prompt</label>
                            <textarea id="llm-system-prompt" rows="4" placeholder="System instructions for the LLM..."></textarea>
                            <span class="form-hint">Instructions that define the LLM's behavior and output format</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="llm-user-prompt-de">German Document Prompt</label>
                            <textarea id="llm-user-prompt-de" rows="12" placeholder="Prompt template for German documents..."></textarea>
                            <span class="form-hint">Template used for German documents. Use <code>{text}</code> where the OCR text should be inserted.</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="llm-user-prompt-en">English Document Prompt</label>
                            <textarea id="llm-user-prompt-en" rows="12" placeholder="Prompt template for English documents..."></textarea>
                            <span class="form-hint">Template used for English documents. Use <code>{text}</code> where the OCR text should be inserted.</span>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveLLMConfig()">Save Prompts</button>
                            <span id="llm-save-status" class="save-status"></span>
                        </div>
                    </section>
                    
                    <!-- Vision LLM Settings -->
                    <section class="settings-section">
                        <div class="section-header">
                            <h2>Vision LLM Settings</h2>
                            <span id="vision-llm-status" class="status-indicator"></span>
                        </div>
                        <p class="section-description">
                            Vision models can extract metadata directly from document images. 
                            Select a vision model from the LLM Models list above to enable this feature.
                            When a vision model is active, these settings control how it processes documents.
                        </p>
                        
                        <div id="vision-llm-options" class="vision-llm-options">
                            <div class="form-group">
                                <label for="vision-llm-device">Inference Device</label>
                                <select id="vision-llm-device">
                                    <option value="CPU">CPU</option>
                                    <option value="GPU">GPU (Intel)</option>
                                    <option value="AUTO">Auto</option>
                                </select>
                                <span class="form-hint">Hardware to use for vision model inference (GPU recommended for Intel devices)</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="vision-llm-max-pixels">Image Size Limit</label>
                                <div class="slider-container">
                                    <input type="range" id="vision-llm-max-pixels" 
                                           min="200704" max="2007040" step="100352" 
                                           value="401408" class="slider">
                                    <span id="vision-llm-max-pixels-display" class="slider-value">~400k px</span>
                                </div>
                                <span class="form-hint">
                                    Maximum image pixels before resizing. Lower = faster processing, Higher = better detail.
                                    <br>Recommended: ~400k for speed on iGPU, ~1M for quality.
                                </span>
                            </div>
                            
                            <hr class="section-divider">
                            
                            <div class="section-header">
                                <h3>Vision LLM Prompts</h3>
                                <button type="button" class="btn btn-secondary btn-small" onclick="resetVisionLLMPrompts()">Reset to Defaults</button>
                            </div>
                            <p class="section-description">Configure the prompts used by the Vision LLM to extract document metadata from images.</p>
                            
                            <div class="form-group">
                                <label for="vision-llm-prompt-de">German Document Prompt</label>
                                <textarea id="vision-llm-prompt-de" rows="12" placeholder="Prompt for German documents..."></textarea>
                                <span class="form-hint">Prompt sent with document images for German documents.</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="vision-llm-prompt-en">English Document Prompt</label>
                                <textarea id="vision-llm-prompt-en" rows="12" placeholder="Prompt for English documents..."></textarea>
                                <span class="form-hint">Prompt sent with document images for English documents.</span>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="saveVisionLLMConfig()">Save Vision Settings</button>
                                <span id="vision-llm-save-status" class="save-status"></span>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Progress Bar (fixed at bottom) -->
    <div id="progress-bar-container" class="progress-bar-container hidden">
        <div class="progress-bar-content">
            <div class="progress-info">
                <span class="progress-status" id="progress-status">Processing...</span>
                <span class="progress-details" id="progress-details"></span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <span class="progress-percentage" id="progress-percentage">0%</span>
            <button class="progress-cancel-btn" id="progress-cancel-btn" onclick="cancelProcessing()" title="Cancel processing">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="progress-steps" id="progress-steps" style="display: none;"></div>
    </div>
    
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <!-- Rejection Reason Modal -->
    <div id="rejection-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Reject Document</h2>
                <button class="modal-close" onclick="closeRejectionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rejection-reason">Reason for rejection (optional)</label>
                    <textarea id="rejection-reason" rows="3" placeholder="Enter reason..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRejectionModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmRejection()">Reject</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="./app.js"></script>
</body>
</html>
